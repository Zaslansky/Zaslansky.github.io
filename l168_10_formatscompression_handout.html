<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title></title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <style type="text/css">
  /*
   * I add this to html files generated with pandoc.
   * Originally from https://gist.github.com/killercup/5917178
   */

  html {
      overflow-y: scroll;
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
  }

  body {
      color: #444;
      font-family: "Source Sans 3", Helvetica-Neue, Helvetica, Sans;
      line-height: 1.5;
      padding: 0.5em;
      margin: auto;
      max-width: 55em;
      background: #fefefe;
  }

  a {
      color: #2171b5;
      text-decoration: underline;
  }

  tr:nth-child(even) {background: #F8F8F8}
  tr:nth-child(odd) {background: #FFF}

  a:visited {
      color: #2171b5;
      text-decoration: none;
  }

  a:focus {
      outline: thin dotted;
  }

  *::-moz-selection {
      background: rgba(255, 255, 0, 0.3);
      color: #000;
  }

  *::selection {
      background: rgba(255, 255, 0, 0.3);
      color: #000;
  }

  a::-moz-selection {
      background: rgba(255, 255, 0, 0.3);
      color: #0645ad;
  }

  a::selection {
      background: rgba(255, 255, 0, 0.3);
      color: #0645ad;
  }

  p {
      margin: 0.75em 0;
  }

  img {
      max-width: 60%;
      max-height:400px;
  }

  video {
      max-width: 60%;
  }


  h1, h2, h3, h4, h5, h6 {
      color: #111;
      line-height: 80%;
      margin-top: 1em;
      margin-bottom: 0.5em;
      font-weight: normal;
  }

  h1, h2, h3, h4, h5, h6 {
      font-weight: bold;
  }

  h1 {
      font-size: 2em;
      line-height: 1.25;
      color:  #084594;

  }

  h1.title {
      margin-top:0.2em;
      font-size: 2em;
      line-height: 1.25;
  }

  h2 {
      font-size: 1.5em;
      line-height: 1.6em;
          color:  #084594;
      padding-bottom: 3px;

  }

  h3 {
      font-size: 1.2em;
      line-height: 1.6em;
  }


  h4 {
      font-size: 1.2em;
      line-height: 1.4em;
  }

  h5 {
      font-size: 1em;
  }

  h6 {
      font-size: 0.9em;
  }

  blockquote {
      color: #666666;
      margin: 0;
      padding-left: 3em;
      border-left: 0.5em #EEE solid;
  }

  hr {
      display: block;
      height: 2px;
      border: 0;
      border-top: 1px solid #aaa;
      border-bottom: 1px solid #eee;
      margin: 0.5em 0;
      padding: 0;
  }

  pre, code, kbd, samp {
      color: #000;
      font-family: monospace, monospace;
      _font-family: 'courier new', monospace;
      font-size: 0.98em;
  }

  pre {
      white-space: pre;
      white-space: pre-wrap;
      word-wrap: break-word;
  }

  .answer {
      color:#CC0033;
      font-style:italic;
  }

  b, strong {
      font-weight: bold;
  }

  dfn {
      font-style: italic;
  }

  ins {
      background: #ff9;
      color: #000;
      text-decoration: none;
  }

  mark {
      background: #ff0;
      color: #000;
      font-style: italic;
      font-weight: bold;
  }

  sub, sup {
      font-size: 75%;
      line-height: 0;
      position: relative;
      vertical-align: baseline;
  }

  sup {
      top: -0.5em;
  }

  sub {
      bottom: -0.25em;
  }

  ul, ol {
      margin: 0.5em 0;
      padding: 0em 0em 0em 1em;
  }

  ul img {
      list-style-type: none;
  }

  li p:last-child {
      margin-bottom: 0;
  }

  hr {
      border-top:none;
      height:0px;
      clear:both;
  }

  ul ul, ol ol {
      margin: .3em 0;
  }

  dl {
      margin-bottom: 1em;
  }

  dt {
      font-weight: bold;
      margin-bottom: .8em;
  }

  dd {
      margin: 0 0 .8em 2em;
  }

  dd:last-child {
      margin-bottom: 0;
  }

  img {
      border: 0;
      -ms-interpolation-mode: bicubic;
      vertical-align: middle;
  }

  figure {
      display: block;
      text-align: center;
      margin: 1em 0;
  }

  figure img {
      border: none;
      margin: 0 auto;
  }

  figcaption {
      font-size: 0.8em;
      font-style: italic;
      margin: 0 0 .8em;
  }

  table {
      margin-bottom: 2em;
      border-bottom: 1px solid #ddd;
      border-right: 1px solid #ddd;
      border-spacing: 0;
      border-collapse: collapse;
  }

  table th {
      padding: .2em 1em;
      background-color: #eee;
      border-top: 1px solid #ddd;
      border-left: 1px solid #ddd;
  }

  table td {
      padding: .2em 1em;
      border-top: 1px solid #ddd;
      border-left: 1px solid #ddd;
      vertical-align: top;
  }

  .author {
      font-size: 1.2em;
      text-align: center;
  }

  @media only screen and (min-width: 480px) {
      body {
  	font-size: 14px;
      }
  }
  @media only screen and (min-width: 768px) {
      body {
  	font-size: 16px;
      }
  }
  @media print {
      * {
  	background: transparent !important;
  	color: black !important;
  	filter: none !important;
  	-ms-filter: none !important;
      }

      body {
  	font-size: 12pt;
  	max-width: 100%;
      }

      a, a:visited {
  	text-decoration: underline;
      }

      hr {
  	height: 1px;
  	border: 0;
  	border-bottom: 1px solid black;
      }

      a[href]:after {
  	content: " (" attr(href) ")";
      }

      abbr[title]:after {
  	content: " (" attr(title) ")";
      }

      .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
  	content: "";
      }

      pre, blockquote {
  	border: 1px solid #999;
  	padding-right: 1em;
  	page-break-inside: avoid;
      }

      tr, img {
  	page-break-inside: avoid;
      }

      img {
  	max-width: 40% !important;
      max-height: 300px !important;
      }

      @page :left {
  	margin: 15mm 20mm 15mm 10mm;
      }

      @page :right {
  	margin: 15mm 10mm 15mm 20mm;
      }

      p, h2, h3 {
  	orphans: 3;
  	widows: 3;
      }

      h2, h3 {
  	page-break-after: avoid;
      }
  }


  ldata {
  	font-size: 0.7em;
  	margin-bottom: 0em;
  	color:#808080;
  	font-style:italic;
  }

  danger {
  	color:#FF0000;
  	font-weight:bold;
  }

  correct {
  	color:#39C900;
  	font-weight:bold;
  }

  clg{
      color:#39C900;
  	font-weight:bold;
  }

  clr{
  	color:#FF0000;
  	font-weight:bold;
  }

  clb{
  	color:#0000CC;
  	font-weight:bold;
  }

  clp{
  	color:#6600FF;
  	font-weight:bold;
  }

  clk{
  	color:#708cef;
  	font-weight:bold;
  }

  clo{
  	color:#CC6600;
  	font-weight:bold;
  }

  sc{
          font-variant: small-caps;
  }

  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="sound-formats-and-compression">Sound Formats and
Compression</h1>
<h3 id="will-styler---lign-168">Will Styler - LIGN 168</h3>
<hr />
<h3 id="lets-back-up-for-a-moment">Let’s back up for a moment</h3>
<ul>
<li><p>We’ve talked a bunch about how to display sound files</p></li>
<li><p>We’ve talked about how to measure sound files</p></li>
<li><p>We’ve even talked about how to manipulate sound files</p></li>
<li><p>… but what is a sound file anyways?</p></li>
</ul>
<hr />
<h3 id="todays-plan">Today’s Plan</h3>
<ul>
<li><p>Audio Capture Review</p></li>
<li><p>Uncompressed WAV Audio</p></li>
<li><p>Why we compress sound</p></li>
<li><p>Lossless Compression formats</p></li>
<li><p>Lossy Compression formats</p></li>
</ul>
<hr />
<h2 id="audio-capture-review">Audio Capture Review</h2>
<hr />
<h3 id="we-know-how-sound-is-stored-on-computers">We know how sound is
stored on computers</h3>
<ul>
<li><p>Electronic measurement of amplitude followed by
quantization</p></li>
<li><p>This is also called ‘Pulse Code Modulation’ or PCM</p></li>
</ul>
<hr />
<h3 id="quantization">Quantization</h3>
<p><img class="r-stretch" src="diagrams/sampling_perfectwave.png"></p>
<hr />
<h3 id="quantization-1">Quantization</h3>
<p><img class="r-stretch" src="diagrams/sampling_sampled.png"></p>
<hr />
<h3 id="quantization-2">Quantization</h3>
<p><img class="r-stretch" src="diagrams/sampling_withlines.png"></p>
<hr />
<h3 id="quantization-3">Quantization</h3>
<p><img class="r-stretch" src="diagrams/sampling_justlines.png"></p>
<hr />
<h3 id="so-at-the-end-we-have-a-list-of-samples">So, at the end we have
a list of samples</h3>
<ul>
<li><p>At a certain bit depth (e.g. precision of amplitude
measurement)</p></li>
<li><p>… along with a sampling rate</p></li>
<li><p>This gives rise to…</p></li>
</ul>
<hr />
<h2 id="uncompressed-audio-files">Uncompressed Audio Files</h2>
<hr />
<h3 id="uncompressed-audio-files-are-lists-of-samples">Uncompressed
Audio Files are lists of samples</h3>
<ul>
<li>With a bit of metadata</li>
</ul>
<hr />
<h3 id="the-waveform-audio-format-wav-contains-three-parts">The Waveform
Audio Format (‘WAV’) contains three parts</h3>
<ul>
<li><p>A Header chunk</p></li>
<li><p>A Format chunk</p></li>
<li><p>A Data Chunk</p></li>
<li><p><a href="http://soundfile.sapp.org/doc/WaveFormat/">Here’s a
great site describing in more detail</a></p></li>
</ul>
<hr />
<h3 id="the-wav-header">The WAV Header</h3>
<ul>
<li><p>The first 12 positions</p></li>
<li><p>‘This is a <a
href="https://en.wikipedia.org/wiki/Resource_Interchange_File_Format">RIFF</a>
file’</p></li>
<li><p>The Filesize</p>
<ul>
<li>This limits WAV to 4GiB, because it’s a 32-bit integer</li>
</ul></li>
<li><p>‘This is a WAVE format’</p></li>
</ul>
<hr />
<h3 id="the-wav-format-sub-chunk">The WAV Format Sub-Chunk</h3>
<ul>
<li><p>‘FMT’, then the length of the format chunk</p></li>
<li><p>The Format of the data</p>
<ul>
<li>1 for PCM, everything else is compressed</li>
</ul></li>
<li><p>The number of Channels</p>
<ul>
<li>1 for Mono, 2 for Stereo</li>
<li>The Maximum is 65535</li>
</ul></li>
<li><p>The sampling rate</p>
<ul>
<li>44100 for ‘44,100 Hz’</li>
<li>1 Hz - 4.3 GHz are possible</li>
</ul></li>
</ul>
<hr />
<h3 id="wav-format-sub-chunk-continued">WAV Format Sub-Chunk
Continued</h3>
<ul>
<li>The Byte Rate
<ul>
<li>(Sample Rate * BitsPerSample * Channels) / 8</li>
</ul></li>
<li>The BlockAlign
<ul>
<li>NumChannels * BitsPerSample/8</li>
<li>Roughly ‘the Number of bytes per sample across all channels’</li>
</ul></li>
<li>The Bit Depth
<ul>
<li>8 bit, 16 bit…</li>
</ul></li>
</ul>
<hr />
<h3 id="wav-data-sub-chunk">WAV Data Sub-Chunk</h3>
<ul>
<li><p>‘DATA’, then the length of this subchunk</p></li>
<li><p>Lots and Lots of Samples, with channels paired</p></li>
<li><p>This contains the actual audio!</p></li>
</ul>
<hr />
<h3 id="wave-files-visualized">WAVE Files, Visualized</h3>
<p><img class="r-stretch" src="phonmedia/wavformat.jpg"></p>
<hr />
<h3 id="aiff-is-basically-the-same-idea">AIFF is basically the same
idea</h3>
<ul>
<li><p>It’s Apple’s version of WAV</p></li>
<li><p>There are slight computational differences to the format</p></li>
<li><p>AIFF can carry more metadata, but isn’t always supported by
applications</p></li>
<li><p><strong>Changing from WAV to AIFF and back is easy and doesn’t
affect quality!</strong></p></li>
</ul>
<hr />
<h3 id="this-is-really-simple">This is really simple</h3>
<ul>
<li><p>The sample data is <em>right there</em> and easy to read
in</p></li>
<li><p>WAV has perfect fidelity</p>
<ul>
<li>Nothing is lost saving as WAV</li>
</ul></li>
<li><p>It’s able to be very, very large</p>
<ul>
<li>Up to 4GB, which is around 6 hours of 44,100/16 audio</li>
<li><a href="https://en.wikipedia.org/wiki/RF64">RF64</a> allows you to
go larger</li>
</ul></li>
<li><p>PCM data will always be able to be read, so it’s
<em>archival</em></p>
<ul>
<li>Doesn’t require any fancy libraries or proprietary filetypes</li>
<li>WAV PCM is the dumbest, most replicable format possible</li>
</ul></li>
<li><p>You don’t spend any cycles <em>compressing the data</em></p></li>
</ul>
<hr />
<h3 id="but-its-really-really-large">… but it’s really, really
large</h3>
<ul>
<li><p>44,100 16-bit datapoints per second</p></li>
<li><p>~1400 kpbs (Kilobits per second)</p></li>
<li><p>~10.5 megabytes per minute</p></li>
<li><p><strong>This is a lot to send</strong></p>
<ul>
<li>Wait, what does sending look like anyways?</li>
</ul></li>
</ul>
<hr />
<h2 id="streaming-vs.-static-audio">Streaming vs. Static Audio</h2>
<hr />
<h3 id="sending-audio-can-take-two-forms">Sending Audio can take two
forms</h3>
<ul>
<li><p>Sending Complete files</p></li>
<li><p>Streaming the audio chunk-wise</p></li>
</ul>
<hr />
<h3 id="sending-complete-files">Sending Complete files</h3>
<ul>
<li><p>I have a file, and you ask me for it</p></li>
<li><p>I transmit the entire file to you, whole</p></li>
<li><p>Once it downloads, you store it on your device</p></li>
<li><p>You play back the file</p></li>
</ul>
<hr />
<h3 id="streaming-audio">Streaming Audio</h3>
<ul>
<li><p>Break the audio into chunks of a sensible size</p>
<ul>
<li>Spotify uses 512kB, ~4 seconds</li>
</ul></li>
<li><p>Send the audio chunk-by-chunk to the device when it starts
playback</p></li>
<li><p><em>Buffer</em> the chunks on the local device in case of
slowdowns or losses</p></li>
<li><p><em>Play back</em> the file from the buffer, adding new chunks as
they arrive</p></li>
<li><p>You’ve got the whole file at the end, if all chunks are
streamed</p></li>
</ul>
<hr />
<h3 id="streaming-has-lots-of-benefits">Streaming has lots of
benefits</h3>
<ul>
<li>You don’t send the whole file if they don’t ask for it
<ul>
<li>“Wow, this podcast is awful”</li>
<li>“I want to jump to this chapter”</li>
</ul></li>
<li>You can stream a file larger than they can store
<ul>
<li>“Remove played chunks from the buffer after they’re played”</li>
</ul></li>
<li>You’re not transmitting meaningfully more data
<ul>
<li>The cost of streaming a whole file is roughly the same as sending
it</li>
<li>So, there’s little downside</li>
</ul></li>
<li>You don’t have to download everything at once
<ul>
<li>“Why send his entire spotify library when he just keeps listening to
Shpongle?”</li>
</ul></li>
</ul>
<hr />
<h3 id="there-are-a-few-pain-points">There are a few pain points</h3>
<ul>
<li>Streaming requires an active connection
<ul>
<li>If you disconnect from the network, you can only play your
buffer</li>
</ul></li>
<li>Streaming often doesn’t give you the file at the end
<ul>
<li>This is an upside for content cartels, and a downside for
consumers</li>
</ul></li>
<li>Streaming is <em>synchronous</em>
<ul>
<li>Your servers have to be online all the time</li>
</ul></li>
<li>Streaming means you <em>might send the same file twice</em>
<ul>
<li>“Really? OK, send ‘In Keeping Secrets of the Silent Earth 3’
AGAIN”</li>
</ul></li>
<li>Streaming requires you to <em>send the file faster than it can be
listened to</em></li>
</ul>
<hr />
<h3 id="streaming-helps-to-make-sending-easier">Streaming helps to make
sending easier</h3>
<ul>
<li><p>… but we still want to send sound in formats that are as small as
possible</p></li>
<li><p>This usually involves making an Audio Codec</p></li>
</ul>
<hr />
<h3 id="what-is-a-codec">What is a codec?</h3>
<p>Codecs encode and decode signals</p>
<ul>
<li><p>(This is a portmanteau of encoder-decoder)</p></li>
<li><p>In the audio world, it encodes the sample amplitudes into a
different and more space-efficient format</p></li>
</ul>
<hr />
<h3 id="codecs-arent-quite-the-same-as-audio-formats">Codecs aren’t
<em>quite</em> the same as audio formats</h3>
<ul>
<li><p>Audio file formats are packages including data in one or more
codecs</p></li>
<li><p>All videos include audio which is stored or compressed with a
codec</p></li>
<li><p>It’s possible to have different codecs with the same ‘file
type’</p>
<ul>
<li>Occasionally, this causes video files not to open with audio, or
means files won’t convert or work with your software</li>
</ul></li>
<li><p>Many codecs are <em>compressed</em></p></li>
</ul>
<hr />
<h2 id="why-we-compress-sound">Why we compress sound</h2>
<hr />
<h3 id="why-uncompressed-formats-suck">Why uncompressed formats
suck</h3>
<ul>
<li><p><strong>Loading Data</strong>: How long does it take to open a
file, and how much RAM does it require?</p></li>
<li><p><strong>Storage Cost</strong>: How much drive space do you need
to store what you have?</p></li>
<li><p><strong>Bandwidth Cost</strong>: How much data do you have to
send to share a sound</p></li>
<li><p><strong>Bandwidth Limits</strong>: How quickly can you send
data?</p></li>
</ul>
<hr />
<h3 id="loading-times">Loading Times</h3>
<ul>
<li><p>It takes longer to open a bigger file</p></li>
<li><p>It requires more disk reading and writing</p>
<ul>
<li>This adds up in a system constantly reading and writing audio</li>
</ul></li>
<li><p>Slow machines take longer to load larger files</p></li>
<li><p>Large files take more space in memory</p></li>
</ul>
<hr />
<h3 id="storage-costs">Storage Costs</h3>
<ul>
<li>Spotify has ~100,000,000 songs
<ul>
<li>The Average Song (3.5 minutes) is 37 Megabytes as a WAV file</li>
</ul></li>
<li>Phones recording audio would quickly run out of space
<ul>
<li>The Base Model iPhone could store only 180 hours of WAV audio</li>
</ul></li>
<li>Music Collections would be huge
<ul>
<li>My music collection is about 482.5 Hours</li>
<li>This is 300GB of music alone</li>
</ul></li>
<li>Backing up data becomes more costly
<ul>
<li>Two is one, and one is none. Back up your computers, damnit.</li>
</ul></li>
</ul>
<hr />
<h3 id="bandwidth-costs">Bandwidth Costs</h3>
<ul>
<li><p>It’s not free to send data into and out of data centers</p></li>
<li><p><a
href="https://www.victoriabuzz.com/2021/07/canada-ranked-the-worst-out-of-44-countries-for-the-cost-of-mobile-phones/">US
Cell Provides charge some of the highest rates for data</a></p>
<ul>
<li>… and you don’t want to use more data than you have to</li>
</ul></li>
<li><p>Transferring larger files between machines ‘clogs’ internal
networks more</p></li>
</ul>
<hr />
<h3 id="bandwidth-limitations">Bandwidth Limitations</h3>
<ul>
<li><p><a
href="https://broadbandnow.com/report/2018-fcc-international-data-insights">US
Internet Providers are the among the worst in the developed
world</a></p></li>
<li><p>Your Cell Phone can’t necessarily ‘keep up’ with downloading
uncompressed data</p></li>
<li><p>Some situations are even lower bandwidth (e.g. radio
transmission, satellite calls)</p></li>
<li><p>Smaller audio formats mean more people can be served by the same
server/cell tower</p></li>
</ul>
<hr />
<h3 id="so-we-want-our-audio-files-to-be-small">So, we want our audio
files to be small</h3>
<ul>
<li><p>We want our audio files to take up <em>as little space as we can
get away with</em></p></li>
<li><p>We want our voice and audio transmissions to use <em>as little
bandwidth as we can</em></p></li>
<li><p>We want to be able open files <em>even on crappy
computers</em></p></li>
<li><p>We need to be able to stream audio <em>faster than it can be
listened to</em></p></li>
</ul>
<hr />
<h3 id="this-forces-us-to-use-compression">This forces us to use
<em>compression</em></h3>
<ul>
<li><p>Compression just turns a file into a smaller file with
either…</p>
<ul>
<li><p>Exactly the same amount of information (<strong>Lossless
Compression</strong>)</p></li>
<li><p>Less information, but losing things you likely don’t care about
(<strong>Lossy compression</strong>)</p></li>
</ul></li>
<li><p>Compression has a computational cost!</p>
<ul>
<li>The file must be encoded, and decoded</li>
<li>Greater compression generally requires greater computation on both
ends</li>
</ul></li>
</ul>
<hr />
<h2 id="lossless-compression">Lossless Compression</h2>
<hr />
<h3 id="aside-data-compression-is-a-huge-field">Aside: Data Compression
is a huge field</h3>
<ul>
<li><p>You could spend a career here</p></li>
<li><p>Better data compression could make you a billionaire</p>
<ul>
<li>This was the plot of <a
href="https://en.wikipedia.org/wiki/Silicon_Valley_(TV_series)">Silicon
Valley</a></li>
</ul></li>
<li><p>We are just barely scratching the surface, and focusing on
audio</p></li>
<li><p><strong>File compression technology is incredibly
cool</strong></p></li>
</ul>
<hr />
<h3 id="lossless-audio-compression-preserves-the-exact-signal">Lossless
Audio Compression preserves <em>the exact signal</em></h3>
<ul>
<li><p>“How can we make this audio smaller, while retaining every last
bit of information we started it”</p></li>
<li><p>Lossless audio compression throws away nothing</p></li>
<li><p>You should be able to recover <em>the exact PCM signal</em> from
a lossless file</p>
<ul>
<li>Turning a losslessly compressed file back into WAV is trivial and
easy</li>
</ul></li>
</ul>
<hr />
<h3 id="the-dumbest-approach-file-compression">The Dumbest Approach:
File Compression</h3>
<ul>
<li><p>Use file compression tools designed for other files (e.g. zip,
7z, zstd, rar)</p></li>
<li><p>Zip the WAV file, and then unzip it before playing</p></li>
<li><p><strong>DO NOT DO THIS</strong></p>
<ul>
<li>It works fine, but it is dumb</li>
</ul></li>
<li><p>This achieves very poor compression, and requires you to undo it
for each listening</p>
<ul>
<li>Files will be ~80-90% of the original file size</li>
</ul></li>
</ul>
<hr />
<h3 id="the-smartest-approach-flac">The Smartest Approach: FLAC</h3>
<ul>
<li><p>FLAC is the ‘Free, Lossless Audio Codec’</p>
<ul>
<li>Developed by <a
href="https://en.wikipedia.org/wiki/Xiph.Org_Foundation">the Xiph.org
Foundation</a></li>
</ul></li>
<li><p>It’s a free (as in libre and gratis) way to compress audio
files</p></li>
<li><p>This results in .flac files</p></li>
</ul>
<hr />
<h3 id="the-flac-process">The FLAC Process</h3>
<ul>
<li><p>Step 1: Split the audio into frames</p></li>
<li><p>Step 2: Approximate the frames</p></li>
<li><p>Step 3: Find the residuals</p></li>
<li><p>Step 4: Encode the residuals</p></li>
<li><p>Step 5: Save the result</p></li>
</ul>
<hr />
<h3 id="flac-step-1-framing">FLAC Step 1: Framing</h3>
<ul>
<li><p>Break the file into frames, with a default of 4096 samples</p>
<ul>
<li>For stereo, each channel will be a subframe</li>
</ul></li>
<li><p>The frame size is tunable for better compression</p></li>
<li><p>Because it’s done framewise, it’s <em>well optimized for
streaming!</em></p></li>
</ul>
<hr />
<h3 id="flac-step-2-approximation">FLAC Step 2: Approximation</h3>
<ul>
<li><p>Use either LPC or a polynomial fit to approximate the
signal</p></li>
<li><p>Linear Predictive Coding does a great job of capturing the
spectral shape</p>
<ul>
<li>The Source/Excitation signal is modeled in the next step</li>
</ul></li>
<li><p>Very simple frames (e.g. silence, or a single bass note) may be
more easily approximated with a polynomial</p></li>
<li><p>This will get you <em>most of the way there</em> with very little
data</p>
<ul>
<li>Just the LPC coefficients, or a few numbers describing the
polynomial</li>
</ul></li>
<li><p><strong>You don’t have to model the signal exactly in this
step</strong></p></li>
</ul>
<hr />
<h3 id="flac-step-3-finding-the-residuals">FLAC Step 3: Finding the
Residuals</h3>
<ul>
<li><p>You’ve stored <em>a big chunk of the signal</em> in <em>very
little data</em></p></li>
<li><p>Now subtract the modeled signal from the input signal</p></li>
<li><p>This yields a <em>much simpler</em> signal called the
‘Residuals’</p></li>
</ul>
<hr />
<h3 id="flac-step-4-encode-the-residuals">FLAC Step 4: Encode the
residuals</h3>
<ul>
<li>This is done using <strong>Rice Coding</strong> and other
compression approaches
<ul>
<li>Black-box alert!</li>
</ul></li>
<li>Intuition: We models the residuals more compactly when they’re
closer to zero
<ul>
<li>This means that better approximations make for better residual
coding</li>
</ul></li>
<li>Stereo tracks are analyzed in terms of their difference from one
another
<ul>
<li>“Now we need to model what differs between left and right”</li>
</ul></li>
<li>Residuals are stored <em>with zero data loss</em>
<ul>
<li>Compression comes from clever coding, not throwing data away</li>
</ul></li>
</ul>
<hr />
<h3 id="flac-step-5-save-the-resulting-frame-data">FLAC Step 5: Save the
resulting frame data</h3>
<ul>
<li><p>Each frame has LPC/Polynomial Coefficients, Channel Difference,
and encoded residuals</p></li>
<li><p>Also save metadata (e.g. Sampling Rate, Bit Depth, Artist, Album,
Song Name, Year, etc)</p></li>
</ul>
<hr />
<h3 id="flac-playback">FLAC Playback</h3>
<ul>
<li><p>Read the frame’s data</p></li>
<li><p>Generate the signal represented by the LPC and
Polynomial</p></li>
<li><p>Unpack the residuals and add them to the LPC signal</p></li>
<li><p>Create the other channel using the stored difference</p></li>
<li><p>Play back the waveform</p></li>
</ul>
<hr />
<h3 id="this-is-completely-lossless">This is completely
<em>lossless</em></h3>
<ul>
<li><p>With the LPC and residuals, you can recover the <em>exact
signal</em> and recreate the WAV</p></li>
<li><p>This is high fidelity</p>
<ul>
<li>Tidal’s <a href="https://tidal.com/sound-quality">High Fidelity</a>
mode is FLAC</li>
</ul></li>
<li><p>You are just being clever in storing the waveform</p>
<ul>
<li>Very, very clever!</li>
</ul></li>
<li><p><strong>FLAC can reduce file sizes to 50-60% of the
original!</strong></p></li>
</ul>
<hr />
<h3 id="flac-isnt-the-only-lossless-codec">FLAC isn’t the only lossless
codec</h3>
<ul>
<li>WavPack is neat
<ul>
<li>You get a small, compressed, lossy version and a <em>correction</em>
file that can turn it back into a lossless version</li>
<li>It’s also free and open</li>
</ul></li>
<li>Dolby TrueHD is designed for multichannel audio
<ul>
<li>Designed for BluRay and Theatrical releases</li>
</ul></li>
<li>‘Apple Lossless (ALAC)’ is Apple’s Lossless Codec
<ul>
<li>It is strictly worse than FLAC in nearly every way</li>
<li>… but Apple won’t support FLAC for some reason</li>
</ul></li>
<li><strong>All are about equivalent in compression (50-60% of the WAV
file size)</strong></li>
</ul>
<hr />
<h3 id="sometimes-we-need-to-compress-more">Sometimes, we need to
compress more</h3>
<ul>
<li>… and that means we need to resort to…</li>
</ul>
<hr />
<h2 id="lossy-compression">Lossy Compression</h2>
<hr />
<h3 id="lossless-vs.-lossy-compression">Lossless vs. Lossy
Compression</h3>
<ul>
<li><p>Lossless compression asks “What can I do to make the file smaller
while keeping the same exact data?”</p></li>
<li><p>Lossy compression asks “What can I throw away to make the file
smaller while keeping the human from noticing?”</p></li>
<li><p>Lossy compression <em>is tuned to human perception</em>!</p></li>
<li><p><a
href="https://observer.com/2008/09/suzanne-vega-is-the-mother-of-the-mp3/">mp3
was developed for Suzanne Vega’s “Tom’s Diner”</a></p></li>
</ul>
<hr />
<h3 id="lossy-codecs-are-everywhere">Lossy codecs are everywhere</h3>
<ul>
<li><p>mp3 is the most well known lossy codec</p>
<ul>
<li>AAC is Apple’s version</li>
</ul></li>
<li><p>Opus and Vorbis are free and libre lossy codecs</p></li>
<li><p>LDAC, AAC, aptX are commonly used to send audio to bluetooth
headphones</p></li>
<li><p>There are dedicated codecs for voice that we’ll talk about next
time!</p></li>
</ul>
<hr />
<h3 id="lossy-compression-throws-away-information-strategically">Lossy
Compression throws away information strategically</h3>
<ul>
<li><p>Using things like Discrete Cosine Transform and LPC to capture
the ‘most important’ elements</p></li>
<li><p>Also uses psychoacoustic knowledge</p>
<ul>
<li>“The human won’t be able to hear this part anyways”</li>
</ul></li>
<li><p>“Let’s throw away or simplify the stuff that doesn’t matter as
much to the human!”</p></li>
</ul>
<hr />
<h3 id="its-a-lot-like-image-compression">It’s a lot like image
compression!</h3>
<hr />
<p><img class="wide" src="phonmedia/compression1.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression2.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression3.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression4.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression5.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression6.jpg"></p>
<hr />
<p><img class="wide" src="phonmedia/compression7.jpg"></p>
<hr />
<h3 id="heres-what-it-looks-like-when-you-make-it-lossless-again">Here’s
what it looks like when you make it lossless again</h3>
<hr />
<p><img class="wide" src="phonmedia/compression7.jpg"></p>
<hr />
<h3 id="mp3-encoding">MP3 Encoding</h3>
<ul>
<li><p>Frame the data (mp3 is usually 1152 samples per frame)</p></li>
<li><p>Use a <a
href="https://en.wikipedia.org/wiki/Discrete_cosine_transform">Modified
Discrete Cosine Transform</a> to turn the data into coefficients
representing components in the frequency domain</p></li>
<li><p>Save more, less, or no detail for chunks of the signal <em>based
on how humans perceive sound</em></p>
<ul>
<li>“This isn’t critical, so let’s save it with less precision”</li>
<li>“They’ll never hear this quiet bit next to a loud one, so,
yeeet!”</li>
</ul></li>
<li><p>Now, save the coefficients efficiently</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman
coding</a> is used.</li>
</ul></li>
</ul>
<hr />
<h3 id="you-can-choose-how-much-to-compress-the-sounds">You can choose
how much to compress the sounds!</h3>
<ul>
<li><p>The <em>Bitrate</em> dictates how many bits are required to
capture a second of audio</p>
<ul>
<li>The unit is ‘kbps’, Kilobits per second</li>
</ul></li>
<li><p>‘Variable Bitrate’ (VBR) is the same idea, but adapts well to
varied complexity</p></li>
<li><p>Lower bitrate means more compression, but more data loss</p>
<ul>
<li>Store fewer coefficients and throw out more data</li>
</ul></li>
<li><p>This is independent of bit depth!</p></li>
</ul>
<hr />
<h3
id="sound-compression-again-shpongle-nothing-is-something-worth-doing">Sound
Compression (Again, Shpongle ‘Nothing is something worth doing’)</h3>
<p>1400kbps
wav<audio controls src="phonmedia/nothingsomething.wav"></audio></p>
<p>320kbps mp3
<audio controls src="phonmedia/nothingsomething320kbps.mp3"></audio></p>
<p>192kbps mp3
<audio controls src="phonmedia/nothingsomething192kbps.mp3"></audio></p>
<p>128kbps mp3
<audio controls src="phonmedia/nothingsomething128kbps.mp3"></audio></p>
<hr />
<h3
id="sound-compression-again-shpongle-nothing-is-something-worth-doing-1">Sound
Compression (Again, Shpongle ‘Nothing is something worth doing’)</h3>
<p>Uncompressed WAV
<audio controls src="phonmedia/nothingsomething.wav"></audio></p>
<p>64kbps mp3
<audio controls src="phonmedia/nothingsomething64kbps.mp3"></audio></p>
<p>48kbps mp3
<audio controls src="phonmedia/nothingsomething48kbps.mp3"></audio></p>
<p>32kbps mp3
<audio controls src="phonmedia/nothingsomething32kbps.mp3"></audio></p>
<p>8kbps mp3
<audio controls src="phonmedia/nothingsomething8kbps.mp3"></audio></p>
<hr />
<video class="wide" controls src="video/bitrat.mp4">
</video>
<p>Original from <a href="https://www.youtube.com/watch?v=wBnevSbdb7g"
class="uri">https://www.youtube.com/watch?v=wBnevSbdb7g</a></p>
<hr />
<h3 id="apples-aac-is-very-similar-to-mp3s-approach">Apple’s AAC is very
similar to mp3’s approach</h3>
<ul>
<li><p>It just uses longer blocks, and a few other techniques to improve
compression</p></li>
<li><p>It’s more efficient, and yields better quality for the same
filesize</p></li>
<li><p>It’s not free, and not supported by as many devices</p></li>
</ul>
<hr />
<h3 id="opus-is-a-free-and-open-mdct-based-codec">Opus is a free and
open MDCT-based codec</h3>
<ul>
<li><p>There are some tweaks, but it’s the same basic idea</p></li>
<li><p>Quality is at or beyond mp3 at similar bitrates</p>
<ul>
<li>and it supports a much wider set of bitrates</li>
</ul></li>
<li><p>It’s less widely supported, as it’s newish (~2011)</p></li>
<li><p>“Free and open” matters because…</p></li>
</ul>
<hr />
<h3 id="audio-codecs-are-full-of-patent-trolls-and-lawyers">Audio Codecs
are full of patent trolls and lawyers</h3>
<ul>
<li><p>mp3 has had lots of battles with content cartels and patent
trolls</p>
<ul>
<li><a
href="https://en.wikipedia.org/wiki/MP3#Licensing,_ownership,_and_legislation">It
was ugly and complicated</a></li>
<li>Most of the relevant patents expired in 2017, so it’s basically free
and open now</li>
</ul></li>
<li><p>AAC is heavily patent encumbered until 2031</p>
<ul>
<li>Free and open implementations are hindered by patent trolling from
Apple and others</li>
</ul></li>
<li><p>Voice Codecs (next time) are a hellscape of licensing and
patents</p></li>
<li><p><em>insert gigantic rant about proprietary
standards</em></p></li>
</ul>
<hr />
<h3 id="lossy-compression-of-audio-throws-away-data">Lossy compression
of audio throws away data!</h3>
<ul>
<li><p>Compression is irreversible</p></li>
<li><p>Humans generally struggle to differentiate wav and &gt;256kbps
mp3</p></li>
<li><p>Loss that you can’t hear can still affect measurements of
speech</p>
<ul>
<li>Some measurements more than others</li>
</ul></li>
<li><p>Lower bitrates will have stronger effects, but be
careful!</p></li>
<li><p>What do we use for speech?</p></li>
</ul>
<hr />
<h3 id="these-are-general-purpose-codecs">These are general purpose
codecs</h3>
<ul>
<li><p>They’re meant to compress <em>anything</em></p>
<ul>
<li>… and they’re quite good at it</li>
</ul></li>
<li><p><strong>Can we do better if we know we’re encoding
speech?</strong></p>
<ul>
<li>Next time!</li>
</ul></li>
</ul>
<hr />
<h3 id="wrapping-up">Wrapping up</h3>
<ul>
<li><p>WAV is simplistic and samplistic</p></li>
<li><p>Compression is useful for working with audio</p></li>
<li><p>Lossless compression saves space and sacrifices
<strong>nothing</strong></p></li>
<li><p>Lossy compression makes much smaller files, but at a very real
cost</p></li>
</ul>
<hr />
<p><huge>Thank you!</huge></p>
</body>
</html>
